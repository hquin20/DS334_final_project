---
title: "Shiny App"
author: "Hailey Quintavalle"
format: html
---


```{r message = F}
library(tidyverse)
initial_data <- read_csv("data/mxmh_survey_results.csv")
```

```{r}
wrangled_data <- initial_data |> rename(primary_streaming_service = `Primary streaming service`,
               hours_per_day = `Hours per day`,
               while_working = `While working`,
               fav_genre = `Fav genre`,
               foreign_languages = `Foreign languages`,
               music_effects = `Music effects`,
               Classical = `Frequency [Classical]`,
               Country = `Frequency [Country]`,
               EDM = `Frequency [EDM]`,
               Folk = `Frequency [Folk]`,
               Gospel = `Frequency [Gospel]`,
               Hip_hop = `Frequency [Hip hop]`,
               Jazz = `Frequency [Jazz]`,
               K_pop = `Frequency [K pop]`,
               Latin = `Frequency [Latin]`,
               Lofi = `Frequency [Lofi]`,
               Metal = `Frequency [Metal]`,
               Pop = `Frequency [Pop]`,
               R_B = `Frequency [R&B]`,
               Rap = `Frequency [Rap]`,
               Rock = `Frequency [Rock]`,
               Video_game_music = `Frequency [Video game music]`) |>
  select(-Permissions) |> 
  mutate(music_improve = recode(music_effects, 
                                'Improve'= '1', 
                                'No effect'='0', 
                                'Worsen' = '-1')) |>
  mutate(music_improve = as.numeric(music_improve))
```

```{r}
numeric_music <- wrangled_data |> 
  mutate(Classical = recode(Classical, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Country = recode(Country, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(EDM = recode(EDM, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Folk = recode(Folk, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Gospel = recode(Gospel, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Hip_hop = recode(Hip_hop, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Jazz = recode(Jazz, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(K_pop = recode(K_pop, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Latin = recode(Latin, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Lofi = recode(Lofi, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Metal = recode(Metal, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Pop = recode(Pop, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(R_B = recode(R_B, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Rap = recode(Rap, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Rock = recode(Rock, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |>
  mutate(Video_game_music = recode(Video_game_music, 
                            'Never'='1', 
                            'Rarely'='2', 
                            'Sometimes' = '3', 
                            'Very frequently' = '4')) |> 
  mutate(Classical = as.numeric(Classical),
         Country = as.numeric(Country),
         EDM = as.numeric(EDM),
         Folk = as.numeric(Folk),
         Gospel = as.numeric(Gospel),
         Hip_hop = as.numeric(Hip_hop),
         Jazz = as.numeric(Jazz),
         K_pop = as.numeric(K_pop),
         Latin = as.numeric(Latin),
         Lofi = as.numeric(Lofi),
         Metal = as.numeric(Metal),
         Pop = as.numeric(Pop),
         R_B = as.numeric(R_B),
         Rap = as.numeric(Rap),
         Rock = as.numeric(Rock),
         Video_game_music = as.numeric(Video_game_music))
  
```

plan: filter by those who said they felt symptoms of [anxiety] AND said that music had improved their mental health --> then find which genres that group listens to the most 

--> shiny app ideas: 

- choose disorder from select input 

- choose how many genres you want to see on plot with slider?

- for each disorder, top genres in plot change accordingly 

- top genre is highlighted somehow? (maybe) 

- slider for number of symptoms someone experiences of that disorder? 

- IF possible: change improvement option from Improve to Worsen with radio buttons - observe the opposite effects


```{r}
library(shiny)

ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      selectInput("sel_disorder",
                  "Select Symptoms",
                  choices = c("Anxiety", "Depression", "Insomnia", "ODC")),
       sliderInput("n_symptoms", 
                  "Number of Reported Symptoms",
                  1, 10, 5),
      sliderInput("top_n", 
                  "Number of Genres",
                  1, 16, 8),
      radioButtons("sel_improve", 
                   "Improve or Worsen?",
                   c("Improve", "Worsen", "No effect"))
    ),
    mainPanel(
      plotOutput("genres_plot")
    )
  )
    
)

server <- function(input, output, session) {
  
   data_react <- reactive({
       numeric_music |> mutate(Classical = if_else(Classical >= 3, 1, 0), ## only if sometimes or frequently 
                        Country = if_else(Country >= 3, 1, 0),
                        EDM = if_else(EDM >= 3, 1, 0),
                        Folk = if_else(Folk >= 3, 1, 0),
                        Gospel = if_else(Gospel >= 3, 1, 0),
                        'Hip Hop' = if_else(Hip_hop >= 3, 1, 0),
                        Jazz = if_else(Jazz >= 3, 1, 0),
                        'K Pop' = if_else(K_pop >= 3, 1, 0),
                        Latin = if_else(Latin >= 3, 1, 0),
                        Lofi = if_else(Lofi >= 3, 1, 0),
                        Metal = if_else(Metal >= 3, 1, 0),
                        Pop = if_else(Pop >= 3, 1, 0),
                       `R&B` = if_else(R_B >= 3, 1, 0),
                        Rap = if_else(Rap >= 3, 1, 0),
                        Rock = if_else(Rock >= 3, 1, 0),
                        'Video Game Music' = if_else(Video_game_music >= 3, 1, 0)) |>
  pivot_longer(c(Classical, Country, EDM, Folk, Gospel, `Hip Hop`, Jazz, 
                 'K Pop', Latin, Lofi, Metal, Pop, 'R&B', Rap, Rock, 'Video Game Music'),
               names_to = "genres", 
               values_to = "genre_listen") |> 
  filter(genre_listen == 1,                    ## must show at least one symptom
         music_effects == input$sel_improve,
         Anxiety > input$n_symptoms) |>  ## must create indicator variable for disorders --> filter by that
  group_by(genres) |>
  summarise(n = n()) |>
  top_n(input$top_n, wt = n)
   })


  output$genres_plot <- renderPlot({
    ggplot(data = data_react(), aes(x = fct_reorder(genres, n), y = n)) +
      geom_col() +  ## should i do proportions instead? 
      coord_flip() +
      labs(x = "Genres")
  })

}

shinyApp(ui, server)
```


```{r}
 numeric_music |> mutate(Classical = if_else(Classical >= 3, 1, 0), ## only if sometimes or frequently 
                        Country = if_else(Country >= 3, 1, 0),
                        EDM = if_else(EDM >= 3, 1, 0),
                        Folk = if_else(Folk >= 3, 1, 0),
                        Gospel = if_else(Gospel >= 3, 1, 0),
                        'Hip Hop' = if_else(Hip_hop >= 3, 1, 0),
                        Jazz = if_else(Jazz >= 3, 1, 0),
                        'K Pop' = if_else(K_pop >= 3, 1, 0),
                        Latin = if_else(Latin >= 3, 1, 0),
                        Lofi = if_else(Lofi >= 3, 1, 0),
                        Metal = if_else(Metal >= 3, 1, 0),
                        Pop = if_else(Pop >= 3, 1, 0),
                       `R&B` = if_else(R_B >= 3, 1, 0),
                        Rap = if_else(Rap >= 3, 1, 0),
                        Rock = if_else(Rock >= 3, 1, 0),
                        'Video Game Music' = if_else(Video_game_music >= 3, 1, 0)) |>
  pivot_longer(c(Classical, Country, EDM, Folk, Gospel, `Hip Hop`, Jazz, 
                 'K Pop', Latin, Lofi, Metal, Pop, 'R&B', Rap, Rock, 'Video Game Music'),
               names_to = "genres", 
               values_to = "genre_listen") |> 
  filter(genre_listen == 1,                    ## must show at least one symptom
         music_effects == "Improve",
         Anxiety == 10) |> 
  group_by(genres) |> 
  summarise(n = n()) |> 
  top_n(5, wt = n) |> 
    ggplot(aes(x = genres, y = n)) + 
      geom_col() + 
      coord_flip() 
    
```


```{r}
 numeric_music |> mutate(Classical = if_else(Classical >= 3, 1, 0), ## only if sometimes or frequently 
                        Country = if_else(Country >= 3, 1, 0),
                        EDM = if_else(EDM >= 3, 1, 0),
                        Folk = if_else(Folk >= 3, 1, 0),
                        Gospel = if_else(Gospel >= 3, 1, 0),
                        'Hip Hop' = if_else(Hip_hop >= 3, 1, 0),
                        Jazz = if_else(Jazz >= 3, 1, 0),
                        'K Pop' = if_else(K_pop >= 3, 1, 0),
                        Latin = if_else(Latin >= 3, 1, 0),
                        Lofi = if_else(Lofi >= 3, 1, 0),
                        Metal = if_else(Metal >= 3, 1, 0),
                        Pop = if_else(Pop >= 3, 1, 0),
                       `R&B` = if_else(R_B >= 3, 1, 0),
                        Rap = if_else(Rap >= 3, 1, 0),
                        Rock = if_else(Rock >= 3, 1, 0),
                        'Video Game Music' = if_else(Video_game_music >= 3, 1, 0)) |>
  pivot_longer(c(Classical, Country, EDM, Folk, Gospel, `Hip Hop`, Jazz,
                 'K Pop', Latin, Lofi, Metal, Pop, 'R&B', Rap, Rock, 'Video Game Music'),
               names_to = "genres", 
               values_to = "genre_listen") |> 
  filter(genre_listen == 1,                    ## must show at least one symptom
         music_effects == "Improve",
         Depression == 6) |>  ## this wont work??
  group_by(genres) |> 
  summarise(n = n()) |> 
  top_n(5, wt = n) 
```




